{% extends "admin/base_site.html" %}
{% block content %}

<style>

.dashboard-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(230px,1fr));
gap:22px;
margin-bottom:35px;
}

.card{
padding:22px;
border-radius:18px;
color:white;
box-shadow:0 15px 35px rgba(0,0,0,.15);
transition:.3s;
}

.card:hover{
transform:translateY(-6px);
}

.bg1{background:linear-gradient(135deg,#6366f1,#4338ca);}
.bg2{background:linear-gradient(135deg,#22c55e,#15803d);}
.bg3{background:linear-gradient(135deg,#fb923c,#ea580c);}
.bg4{background:linear-gradient(135deg,#0ea5e9,#0369a1);}

.big{
font-size:34px;
font-weight:800;
}

.analytics-box{
background:white;
padding:25px;
border-radius:18px;
box-shadow:0 10px 25px rgba(0,0,0,.08);
margin-bottom:30px;
}

</style>

<h1>ðŸ“Š Admin Dashboard</h1>

<!-- ===== STATS ===== -->

<div class="dashboard-grid">

<div class="card bg1">
Products
<div class="big">{{ products_count }}</div>
</div>

<div class="card bg2">
Users
<div class="big">{{ users_count }}</div>
</div>

<div class="card bg3">
Categories
<div class="big">{{ categories_count }}</div>
</div>

<div class="card bg4">
Revenue
<div class="big">â‚¹{{ total_revenue }}</div>
</div>

</div>

<!-- ===== CHARTS ===== -->

<div class="analytics-box">
<h3>ðŸ“ˆ Sales Trend</h3>
<canvas id="salesChart" height="120"></canvas>
</div>

<div class="analytics-box">
<h3>ðŸ“¦ Orders Trend</h3>
<canvas id="ordersChart" height="120"></canvas>
</div>

<!-- ===== JSON DATA ===== -->

{{ sales_data|json_script:"sales-data" }}
{{ orders_data|json_script:"orders-data" }}

<!-- ===== INSIGHT ===== -->

<div class="analytics-box">
<h3>ðŸ¤– AI Insight</h3>
<p>{{ insight }}</p>

{% if best_product %}
ðŸ”¥ Top product: <b>{{ best_product.product__name }}</b> ({{ best_product.qty }} sold)
{% endif %}
</div>

<!-- ===== CHART JS ===== -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

const salesData = JSON.parse(
    document.getElementById("sales-data").textContent
);

const ordersData = JSON.parse(
    document.getElementById("orders-data").textContent
);

// ---- SALES LINE GRAPH ----

new Chart(document.getElementById("salesChart"), {
    type: "line",
    data: {
        labels: salesData.map(d => d.day),
        datasets: [{
            label: "Sales â‚¹",
            data: salesData.map(d => d.total),
            borderWidth: 3,
            tension: 0.4
        }]
    },
    options: {
        responsive: true
    }
});

// ---- ORDERS BAR GRAPH ----

new Chart(document.getElementById("ordersChart"), {
    type: "bar",
    data: {
        labels: ordersData.map(d => d.day),
        datasets: [{
            label: "Orders",
            data: ordersData.map(d => d.count)
        }]
    },
    options: {
        responsive: true
    }
});

</script>

<hr style="margin:40px 0;">

{{ block.super }}

{% endblock %}
